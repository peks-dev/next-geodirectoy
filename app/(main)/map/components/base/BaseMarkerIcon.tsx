'use client';

import { useMemo } from 'react';
import { DivIcon } from 'leaflet';
import { useAppTheme } from '@/lib/hooks/useAppTheme';
import { createLeafletIcon } from '../../utils/iconUtils';

interface BaseMarkerIconProps {
  iconColorClass?: string;
}

const BaseMarkerIconComponent = () => (
  <svg
    width="100%"
    height="100%"
    viewBox="0 0 35 35"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g>
      <path
        d="M10.7137 32.1538C5.16071 25.6798 0.983715 18.3318 0.153714 13.5808C-0.110286 12.0718 -0.0262861 9.86576 0.344714 8.54776C0.955242 6.43611 2.12883 4.53038 3.73971 3.03476C8.97771 -1.76724 17.3127 -0.739238 21.2037 5.18976C23.1157 8.10176 23.5947 11.4168 22.6267 15.0348C21.4257 19.5228 17.4647 26.1378 12.4507 32.0308C12.4507 32.0308 11.5327 33.1098 11.5327 33.1098L10.7127 32.1538C10.7127 32.1538 10.7137 32.1538 10.7137 32.1538ZM13.5177 19.4808C16.3807 18.7478 18.5157 16.6928 19.3897 13.8268C19.7997 12.4868 19.7747 10.5838 19.3327 9.22276C17.9297 4.91276 13.6477 2.59976 9.24671 3.77576C7.29871 4.29676 5.23171 6.03276 4.29371 7.93376C3.04971 10.4588 3.14271 13.3898 4.54271 15.7678C5.15071 16.7998 6.63271 18.2218 7.67271 18.7708C9.44071 19.7038 11.6127 19.9678 13.5177 19.4808C13.5177 19.4808 13.5177 19.4808 13.5177 19.4808ZM9.95571 17.8118C9.05571 17.5698 7.99271 17.0088 7.34771 16.4348C7.34771 16.4348 6.79771 15.9478 6.79771 15.9478C6.79771 15.9478 7.89471 14.6728 7.89471 14.6728C8.68487 13.7702 9.50255 12.8922 10.3466 12.0399C11.6466 10.7389 13.4376 9.19988 13.5366 9.29888C13.5626 9.32488 13.7556 9.56288 13.9656 9.82688C13.9656 9.82688 14.3476 10.3079 14.3476 10.3079C14.3476 10.3079 14.0446 10.6249 14.0446 10.6249C13.5386 11.1549 13.1506 12.2019 12.7466 14.1339C12.3146 16.1989 11.8566 17.3389 11.2996 17.7359C10.8716 18.0409 10.8176 18.0439 9.95561 17.8119C9.95561 17.8119 9.95571 17.8118 9.95571 17.8118ZM11.5177 17.9258C11.5177 17.8858 11.6517 17.6928 11.8157 17.4988C12.2467 16.9858 12.5897 15.9788 13.0657 13.8308C13.6837 11.0398 14.1307 10.2818 14.7957 10.9008C15.1717 11.2518 15.8407 12.5508 16.1077 13.4508C16.3547 14.2818 16.3627 15.4468 16.1257 15.9068C15.9007 16.3408 14.9497 17.0488 14.0657 17.4398C13.1927 17.8258 11.5177 18.1458 11.5177 17.9258C11.5177 17.9258 11.5177 17.9258 11.5177 17.9258ZM6.26071 15.1868C5.75671 14.4918 5.39371 13.4938 5.22671 12.3448C5.10171 11.4908 5.11071 11.3728 5.33271 10.9918C5.69671 10.3638 6.69671 9.82776 8.06771 9.52376C10.3907 9.00876 11.2197 8.77376 11.7547 8.47576C11.7547 8.47576 12.2977 8.17276 12.2977 8.17276C12.2977 8.17276 12.7077 8.57076 12.7077 8.57076C12.9327 8.78876 13.1027 9.00276 13.0847 9.04476C13.0677 9.08776 12.3457 9.77176 11.4817 10.5658C10.1637 11.7778 8.88771 13.1268 6.96171 15.3448C6.96171 15.3448 6.64171 15.7138 6.64171 15.7138L6.26071 15.1868C6.26071 15.1868 6.26071 15.1868 6.26071 15.1868ZM16.5187 14.8498C16.5937 13.7838 16.2867 12.8118 15.4307 11.3948C14.7477 10.2648 14.7577 10.0928 15.5207 9.94976C16.0987 9.84076 16.6927 9.97376 17.2137 10.3278C17.7077 10.6628 17.8047 10.5718 17.3797 10.1738C16.7987 9.62876 16.0747 9.52576 15.1157 9.85176C15.1157 9.85176 14.5307 10.0498 14.5307 10.0498L14.1287 9.58476L13.7257 9.11876C13.7257 9.11876 13.9927 8.83476 13.9927 8.83476C14.3127 8.49276 15.9907 7.32076 16.1577 7.32076C16.5527 7.32076 17.6757 9.50076 17.7107 10.3358C17.7237 10.6328 17.7707 10.9138 17.8177 10.9598C17.9617 11.1038 17.9067 12.2568 17.7167 13.0618C17.5127 13.8753 17.1675 14.6466 16.6967 15.3408C16.6967 15.3408 16.4597 15.6878 16.4597 15.6878L16.5187 14.8498C16.5187 14.8498 16.5187 14.8498 16.5187 14.8498ZM5.29271 10.3068C5.55071 9.01176 6.53671 7.39676 7.49571 6.69676C7.98171 6.34076 8.07271 6.31776 8.76371 6.38076C9.97071 6.48976 11.4637 7.14876 11.8137 7.72676C11.9217 7.90676 11.8937 7.99476 11.6597 8.18576C11.3297 8.45576 10.9647 8.56576 8.77571 9.05076C7.04971 9.43276 6.05271 9.82876 5.54871 10.3328C5.54871 10.3328 5.22171 10.6598 5.22171 10.6598L5.29171 10.3068C5.29171 10.3068 5.29271 10.3068 5.29271 10.3068ZM12.9627 8.33276L12.5157 7.87276C12.5157 7.87276 12.8097 7.53476 12.8097 7.53476C13.2407 7.03776 13.3147 6.44476 13.0207 5.84976C13.0207 5.84976 12.7787 5.35976 12.7787 5.35976C12.7787 5.35976 13.0987 5.42976 13.0987 5.42976C13.6187 5.54076 15.1047 6.29576 15.5587 6.67776C15.5587 6.67776 15.9777 7.02976 15.9777 7.02976C15.9777 7.02976 15.4977 7.31976 15.4977 7.31976C15.2327 7.47876 14.6727 7.87576 14.2527 8.20176C13.8317 8.52676 13.4697 8.79376 13.4487 8.79376C13.4267 8.79376 13.2087 8.58676 12.9627 8.33376C12.9627 8.33376 12.9627 8.33276 12.9627 8.33276ZM11.3977 7.06676C10.4667 6.49276 9.63071 6.21976 8.76471 6.20576C8.76471 6.20576 8.14171 6.19576 8.14171 6.19576C8.14171 6.19576 8.88171 5.83976 8.88171 5.83976C9.73171 5.42976 10.6297 5.23376 11.6527 5.23376C12.4827 5.23376 12.8117 5.47976 12.9467 6.20076C13.0377 6.68776 12.6987 7.48076 12.3767 7.52976C12.2767 7.54476 11.8357 7.33676 11.3977 7.06676C11.3977 7.06676 11.3977 7.06676 11.3977 7.06676Z"
        fill="currentColor"
        transform="translate(5.943 0.945)"
      />
    </g>
  </svg>
);

/**
 * Componente que crea un icono de marcador de Leaflet con manejo de tema
 * Maneja la lógica de color basado en el tema y devuelve un DivIcon listo para usar
 */
function BaseMarkerIcon({ iconColorClass }: BaseMarkerIconProps): DivIcon {
  const { isDark } = useAppTheme();

  // Usar color por defecto si no se especifica
  const colorClass =
    iconColorClass || (isDark ? 'text-white-primary' : 'text-dark-primary');

  // Crear icono con color dinámico basado en tema
  const icon = useMemo(() => {
    return createLeafletIcon(<BaseMarkerIconComponent />, colorClass);
  }, [colorClass]);

  return icon;
}

export default BaseMarkerIcon;
